// Generated by CoffeeScript 1.3.1
var crypto, db, riak, riakClient;

crypto = require('crypto');

riak = require('riak-js');

db = exports;

riakClient = new riak.getClient();

db.putFile = function(path, data, mimetype, callback) {
  return riakClient.saveLarge(path, data, function(err, meta) {
    if (err) {
      return callback.apply(this, arguments);
    }
    return callback(null, path);
  });
};

db.getFile = function(path, callback) {
  return riakClient.getLarge(path, function(err, data, meta) {
    if (err) {
      return callback.apply(this, arguments);
    }
    return callback(null, data);
  });
};

db.putImage = function(data, callback) {
  return crypto.randomBytes(6, function(err, buf) {
    var path;
    path = (Date.now() + buf.toString('hex')).replace(/^(......)(..)(..)(...)(.*)$/g, 'images-$1-$2-$3-$4-$5.jpg');
    return db.putFile(path, data, 'image/jpeg', callback);
  });
};

db.getImage = function(path, callback) {
  return db.getFile(path, callback);
};
