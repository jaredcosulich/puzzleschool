// Generated by CoffeeScript 1.3.3
var Line, db, requireUser, soma;

Line = require('line').Line;

soma = require('soma');

db = require('../lib/db');

requireUser = require('./lib/decorators').requireUser;

soma.routes({
  '/api/fractions/update_level': function() {
    var l, levelInfo,
      _this = this;
    levelInfo = {
      levelName: this.data.level,
      levelInstructions: this.data.instructions,
      levelDifficulty: this.data.difficulty
    };
    l = new Line({
      error: function(err) {
        console.log('Saving level failed:', err);
        return _this.sendError();
      }
    });
    l.add(function() {
      return db.update('fractions_levels', levelInfo.levelName, levelInfo, l.wait());
    });
    return l.add(function() {
      return _this.send();
    });
  },
  '/api/fractions/level/:id': function(_arg) {
    var id, l,
      _this = this;
    id = _arg.id;
    l = new Line({
      error: function(err) {
        console.log('Unable to retrieve level:', err);
        return _this.sendError();
      }
    });
    l.add(function() {
      return db.get('fractions_levels', id, l.wait());
    });
    return l.add(function(levelInfo) {
      return _this.send(levelInfo);
    });
  }
});
