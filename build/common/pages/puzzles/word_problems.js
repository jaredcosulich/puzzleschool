// Generated by CoffeeScript 1.3.3
var LEVELS, soma, wings;

soma = require('soma');

wings = require('wings');

soma.chunks({
  WordProblems: {
    meta: function() {
      return new soma.chunks.Base({
        content: this
      });
    },
    prepare: function(_arg) {
      this.classId = _arg.classId, this.levelId = _arg.levelId;
      this.template = this.loadTemplate("/build/common/templates/puzzles/word_problems.html");
      this.loadScript('/build/common/pages/puzzles/lib/word_problems.js');
      return this.loadStylesheet('/build/client/css/puzzles/word_problems.css');
    },
    build: function() {
      this.setTitle("Interactive Word Problems - The Puzzle School");
      return this.html = wings.renderTemplate(this.template);
    }
  }
});

soma.views({
  WordProblems: {
    selector: '#content .word_problems',
    create: function() {
      this.level = LEVELS[0];
      return this.initLevel();
    },
    initLevel: function() {
      this.$('.problem').html(this.highlightProblem(this.level.problem));
      return this.initNumbers();
    },
    highlightProblem: function(problem) {
      return problem.replace(/(\d+)/g, '<span class=\'number\'>$1</span>');
    },
    initNumbers: function() {
      var index, number, _i, _len, _ref, _results;
      _ref = this.$('.problem .number');
      _results = [];
      for (index = _i = 0, _len = _ref.length; _i < _len; index = ++_i) {
        number = _ref[index];
        number = $(number);
        number.addClass("color_" + (index + 1));
        _results.push(this.createNumber(number.html(), index + 1));
      }
      return _results;
    },
    createNumber: function(value, index) {
      var number;
      number = $(document.createElement('DIV'));
      number.addClass('number');
      number.addClass("color_" + index);
      number.html("<div class='settings'>\n    <i class='icon-cog'></i>\n</div>\n<h3>" + value + "</h3>");
      this.$('.numbers').append(number);
      return this.setNumber(number, value);
    },
    createRange: function(container, magnitude, value) {
      var i, range, _fn, _i,
        _this = this;
      range = $(document.createElement('DIV'));
      range.addClass('range');
      _fn = function(i) {
        var index, label;
        index = $(document.createElement('DIV'));
        index.addClass('index');
        if (i > value) {
          index.addClass('icon-circle-blank');
        } else {
          index.addClass('icon-circle');
        }
        label = $(document.createElement('DIV'));
        label.addClass('label');
        label.html("" + (i * Math.pow(10, magnitude)));
        index.append(label);
        range.append(index);
        return index.bind('click', function() {
          return alert(i);
        });
      };
      for (i = _i = 1; _i <= 10; i = ++_i) {
        _fn(i);
      }
      return container.append(range);
    },
    setNumber: function(container, value) {
      var digit, magnitude, _i, _len, _ref, _results;
      value = parseInt(value);
      _ref = value.toString().match(/\d/g);
      _results = [];
      for (magnitude = _i = 0, _len = _ref.length; _i < _len; magnitude = ++_i) {
        digit = _ref[magnitude];
        _results.push(this.createRange(container, magnitude, digit));
      }
      return _results;
    }
  }
});

soma.routes({
  '/puzzles/word_problems/:classId/:levelId': function(_arg) {
    var classId, levelId;
    classId = _arg.classId, levelId = _arg.levelId;
    return new soma.chunks.WordProblems({
      classId: classId,
      levelId: levelId
    });
  },
  '/puzzles/word_problems/:levelId': function(_arg) {
    var levelId;
    levelId = _arg.levelId;
    return new soma.chunks.WordProblems({
      levelId: levelId
    });
  },
  '/puzzles/word_problems': function() {
    return new soma.chunks.WordProblems;
  }
});

LEVELS = [
  {
    id: 1367965328479,
    difficulty: 1,
    problem: 'Jane has 9 balloons. 6 are green and the rest are blue. How many balloons are blue?'
  }
];
