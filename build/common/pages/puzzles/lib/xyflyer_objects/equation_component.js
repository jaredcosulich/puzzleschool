// Generated by CoffeeScript 1.3.3
var equationComponent,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

equationComponent = typeof exports !== "undefined" && exports !== null ? exports : provide('./equation_component', {});

equationComponent.EquationComponent = (function() {

  function EquationComponent(_arg) {
    this.gameArea = _arg.gameArea, this.equationFragment = _arg.equationFragment, this.equationAreas = _arg.equationAreas, this.trackDrag = _arg.trackDrag, this.endDrag = _arg.endDrag;
    this.clientY = __bind(this.clientY, this);

    this.clientX = __bind(this.clientX, this);

    this.equationAreas || (this.equationAreas = []);
    this.initElement();
    this.initMove();
  }

  EquationComponent.prototype.clientX = function(e) {
    var _ref, _ref1, _ref2, _ref3;
    return (e.clientX || ((_ref = e.targetTouches) != null ? (_ref1 = _ref[0]) != null ? _ref1.pageX : void 0 : void 0) || ((_ref2 = e.touches) != null ? (_ref3 = _ref2[0]) != null ? _ref3.pageX : void 0 : void 0)) - this.gameArea.offset().left;
  };

  EquationComponent.prototype.clientY = function(e) {
    var _ref, _ref1, _ref2, _ref3;
    return (e.clientY || ((_ref = e.targetTouches) != null ? (_ref1 = _ref[0]) != null ? _ref1.pageY : void 0 : void 0) || ((_ref2 = e.touches) != null ? (_ref3 = _ref2[0]) != null ? _ref3.pageY : void 0 : void 0)) - this.gameArea.offset().top;
  };

  EquationComponent.prototype.width = function() {
    return this.element.width();
  };

  EquationComponent.prototype.height = function() {
    return this.element.height();
  };

  EquationComponent.prototype.initElement = function() {
    this.element = $(document.createElement('DIV'));
    this.element.addClass('equation_component');
    this.element.addClass(this.equationAreas.join(' '));
    this.element.html(this.equationFragment);
    this.placeHolder = $(document.createElement('DIV'));
    return this.placeHolder.addClass('place_holder');
  };

  EquationComponent.prototype.initMove = function() {
    var _this = this;
    return this.element.bind('mousedown.move touchstart.move', function(e) {
      return _this.mousedown(e);
    });
  };

  EquationComponent.prototype.appendTo = function(container) {
    container.append(this.element);
    container.append(this.placeHolder);
    return this.placeHolder.hide();
  };

  EquationComponent.prototype.mousedown = function(e) {
    var body,
      _this = this;
    this.gameArea.addClass('dragging');
    body = $(document.body);
    body.bind('mousemove.move touchmove.move', function(e) {
      return _this.move(e);
    });
    body.one('mouseup.move touchend.move', function(e) {
      return _this.endMove(e);
    });
    this.element.addClass('dragging');
    return this.element.show();
  };

  EquationComponent.prototype.move = function(e) {
    var left, top;
    if (e.preventDefault) {
      e.preventDefault();
    }
    left = this.clientX(e) - (this.element.width() / 2);
    top = this.clientY(e) - (this.element.height() / 2);
    if (e.type === 'touchmove') {
      top -= 90;
    }
    this.element.css({
      position: 'absolute',
      left: left,
      top: top
    });
    this.placeHolder.show();
    this.placeHolder.css({
      height: this.element.height(),
      width: this.element.width()
    });
    if (this.trackDrag) {
      return this.trackDrag(left, top, this);
    }
  };

  EquationComponent.prototype.endMove = function(e) {
    this.element.css({
      position: 'static',
      top: 'auto',
      left: 'auto'
    });
    this.element.removeClass('dragging');
    this.gameArea.removeClass('dragging');
    if (this.endDrag(this)) {
      this.element.hide();
      this.placeHolder.show();
    } else {
      this.element.show();
      this.placeHolder.hide();
    }
    return $(document.body).unbind('mousemove.move touchmove.move');
  };

  return EquationComponent;

})();
