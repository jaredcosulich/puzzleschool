// Generated by CoffeeScript 1.3.3
var slider,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };

slider = typeof exports !== "undefined" && exports !== null ? exports : provide('./slider', {});

slider.Slider = (function() {

  Slider.prototype.radius = 6;

  function Slider(_arg) {
    this.paper = _arg.paper, this.x = _arg.x, this.y = _arg.y, this.width = _arg.width, this.min = _arg.min, this.max = _arg.max, this.unit = _arg.unit, this.val = _arg.val;
    this.moveKnob = __bind(this.moveKnob, this);

    this.init();
  }

  Slider.prototype.init = function() {
    var guide, onDrag, onEnd, onStart,
      _this = this;
    this.el = this.paper.set();
    this.range = this.max / this.unit;
    this.segment = this.width / this.range;
    guide = this.paper.path("M" + this.x + "," + this.y + "L" + (this.x + this.width) + "," + this.y);
    guide.attr({
      'stroke': "#ccc",
      'stroke-width': 5,
      'stroke-linecap': 'round'
    });
    this.knob = this.paper.circle(this.x, this.y, this.radius);
    this.knob.attr({
      cursor: 'move',
      stroke: '#555',
      fill: 'r(0.5, 0.5)#ddd-#666'
    });
    this.lastDeltaX = (this.segment * this.val) / this.unit;
    this.deltaX = 0;
    this.knob.transform("t" + this.lastDeltaX + ",0");
    onDrag = function(dX, dY) {
      return _this.moveKnob(dX, dY);
    };
    onStart = function() {
      return _this.el.noClick = true;
    };
    onEnd = function() {
      if (_this.deltaX) {
        _this.propertiesEditor.set('voltage', (_this.voltageCalc(_this.deltaX) / _this.segment) * _this.unit);
        _this.lastDeltaX = _this.deltaX;
      } else {
        _this.el.noClick = false;
      }
      _this.deltaX = 0;
      return $.timeout(10, function() {
        return _this.el.noClick = false;
      });
    };
    this.knob.drag(onDrag, onStart, onEnd);
    this.el.push(guide);
    return this.el.push(this.knob);
  };

  Slider.prototype.moveKnob = function(dX, dY) {
    this.deltaX = this.lastDeltaX + dX;
    if (this.deltaX > this.right - this.left) {
      this.deltaX = this.right - this.left;
    }
    if (this.deltaX < 0) {
      this.deltaX = 0;
    }
    this.deltaX = this.voltageCalc(this.deltaX);
    this.knob.transform("t" + this.deltaX + "," + 0);
    this.initPropertiesGlow(this.el);
    this.propertiesClick(this.el, true);
    return this.propertiesEditor.set('voltage', (this.voltageCalc(this.deltaX) / this.segment) * this.unit);
  };

  Slider.prototype.set = function(val) {
    this.val = val;
    this.lastDeltaX = this.segment * (this.val / this.unit);
    return this.moveKnob(0, 0);
  };

  return Slider;

})();
