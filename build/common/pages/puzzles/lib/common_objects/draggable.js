// Generated by CoffeeScript 1.3.3
var Client, Transformer, draggable;

draggable = typeof exports !== "undefined" && exports !== null ? exports : provide('../common_objects/draggable', {});

Transformer = require('../common_objects/transformer').Transformer;

Client = require('../common_objects/client').Client;

draggable.Draggable = (function() {

  function Draggable() {}

  Draggable.prototype.initDrag = function(dragElement, trackDrag) {
    var _this = this;
    this.dragElement = dragElement;
    this.trackDrag = trackDrag;
    this.transformer = new Transformer(this.dragElement);
    return this.dragElement.bind('mousedown.drag touchstart.drag', function(e) {
      e.stop();
      $(document.body).one('mouseup.drag touchend.drag', function(e) {
        $(document.body).unbind('mousemove.drag touchstart.drag');
        return _this.drag(e, true);
      });
      if (!_this.startX) {
        _this.startX = Client.x(e);
      }
      if (!_this.startY) {
        _this.startY = Client.y(e);
      }
      return $(document.body).bind('mousemove.drag touchstart.drag', function(e) {
        return _this.drag(e);
      });
    });
  };

  Draggable.prototype.drag = function(e, stopDrag) {
    var currentX, currentY;
    currentX = Client.x(e);
    currentY = Client.y(e);
    this.transformer.translate(currentX - this.startX, currentY - this.startY);
    return this.trackDrag(this, currentX, currentY, stopDrag);
  };

  Draggable.prototype.resetDrag = function() {
    delete this.startX;
    delete this.startY;
    return this.transformer.translate(0, 0);
  };

  return Draggable;

})();
