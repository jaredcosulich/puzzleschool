// Generated by CoffeeScript 1.3.3
var circuitous, fn, name, _ref;

circuitous = typeof exports !== "undefined" && exports !== null ? exports : provide('./lib/circuitous', {});

_ref = require('./circuitous_objects/index');
for (name in _ref) {
  fn = _ref[name];
  circuitous[name] = fn;
}

circuitous.ChunkHelper = (function() {

  function ChunkHelper() {}

  return ChunkHelper;

})();

circuitous.ViewHelper = (function() {

  function ViewHelper(_arg) {
    this.el = _arg.el;
    this.init();
  }

  ViewHelper.prototype.$ = function(selector) {
    return $(selector, this.el);
  };

  ViewHelper.prototype.init = function() {
    return this.board = new circuitous.Board({
      el: this.$('.board')
    });
  };

  ViewHelper.prototype.addComponent = function(component) {
    var img,
      _this = this;
    component.appendTo(this.board.cells);
    img = component.el.find('img');
    component.el.css({
      left: -10000
    });
    return img.bind('load', function() {
      component.el.width(img.width());
      component.el.height(img.height());
      return $.timeout(10, function() {
        component.initCurrent();
        return component.initDrag(component.el, function(component, x, y, stopDrag) {
          return _this.dragComponent(component, x, y, stopDrag);
        }, true, component.dragBuffer);
      });
    });
  };

  ViewHelper.prototype.dragComponent = function(component, x, y, state) {
    if (state === 'start') {
      return this.board.removeComponent(component);
    } else if (state === 'stop') {
      if (!this.board.addComponent(component, x, y)) {
        this.board.removeComponent(component);
        return component.resetDrag();
      }
    }
  };

  return ViewHelper;

})();
